# Quick Start

The only requirement is a spack working instance. In particular `$SPACK_ROOT/bin/spack-python` has to be in the PATH.

Note: `cray` module should be loaded also at runtime for using anything built with this spack configuration.

## As a module (for the currently loaded CPE)

```console
cd ~
git clone git@github.com:eth-cscs/spack-config-generator.git
module use ~/spack-config-generator
module load cray spack-config
```

Once loaded, your spack instance will be aware of packages and compilers detected for the currently loaded CPE.

## As a script (for generating all configurations for all CPE available on the system)

```console
git clone git@github.com:eth-cscs/spack-config-generator.git
cd spack-config-generator
/spack-allinone.py
```

This will generate a structure of folders, one per CPE, where you can find ready-to-use presets of spack
configurations which you can use as template and customize as you want. They are just generated and spack
is not aware of them: it is up to you to use them as you prefer.

# Tools

## spack-config

Modulefile template that checks if a CDT/CPE module is loaded and sets the environment variable
`SPACK_SYSTEM_CONFIG_PATH` accordingly (more info here https://github.com/spack/spack/pull/26735).
This instructs the (modern enough) spack instance to use generated configuration files giving access
to Cray provided system packages and compilers for the programming environment used.

Before using it by adding it to `MODULEPATH`, it should be edited so that `SPACK_CSCS_CONFIGS_ROOT` points
to the root of spack configuration folders for cdt/cpe generated by `spack-allinone.py`.

## spack-allinone

Script for generating spack configuration files, i.e. `packages.yaml` and `compilers.yaml`, for all
the CDTs/CPEs available on the system on which the script is executed.
